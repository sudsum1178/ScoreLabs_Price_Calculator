<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Score Labs Price Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root {
  --bg: #060810;
  --s1: #0e1119;
  --s2: #161b27;
  --s3: #1e2435;
  --bdr: #282f42;
  --t1: #eaecf4;
  --t2: #7b849c;
  --t3: #525a70;
  --sc: #00e5a0;
  --sc2: #00c98a;
  --sc-bg: rgba(0,229,160,0.10);
  --sc-bdr: rgba(0,229,160,0.25);
  --gpu: #8b6cff;
  --gpu-bg: rgba(139,108,255,0.10);
  --or: #ff9f43;
  --rd: #ff6b7a;
  --bl: #4da8ff;
  --cy: #22d3ee;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--t1);line-height:1.6;}
.wrap{max-width:1260px;margin:0 auto;padding:20px;}

/* Header */
.hdr{text-align:center;padding:44px 0 36px;border-bottom:1px solid var(--bdr);margin-bottom:36px;}
.hdr .pill{display:inline-block;background:var(--sc-bg);color:var(--sc);font-size:.68rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;padding:4px 14px;border-radius:20px;border:1px solid var(--sc-bdr);margin-bottom:14px;}
.hdr h1{font-family:'Space Mono',monospace;font-size:1.85rem;letter-spacing:-1px;}
.hdr h1 em{font-style:normal;color:var(--sc);}
.hdr p{color:var(--t2);font-size:.9rem;max-width:580px;margin:8px auto 0;}

/* Layout */
.main-grid{display:grid;grid-template-columns:360px 1fr;gap:24px;align-items:start;}
@media(max-width:960px){.main-grid{grid-template-columns:1fr;}}

/* Panel */
.panel{background:var(--s1);border:1px solid var(--bdr);border-radius:14px;padding:24px;position:sticky;top:20px;}
.panel h2{font-size:.95rem;margin-bottom:18px;display:flex;align-items:center;gap:8px;}
.panel h2 .dot{width:8px;height:8px;border-radius:50%;background:var(--sc);display:inline-block;}

/* Form controls */
.fg{margin-bottom:18px;}
.fg label{display:block;font-size:.75rem;font-weight:600;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;}
.fg select,.fg input[type=number]{width:100%;background:var(--s2);border:1px solid var(--bdr);border-radius:8px;padding:10px 12px;color:var(--t1);font-size:.88rem;font-family:'DM Sans',sans-serif;outline:none;transition:border-color .2s;}
.fg select:focus,.fg input:focus{border-color:var(--sc);}
.fg select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='7'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%237b849c' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px;}
.range-row{display:flex;align-items:center;gap:10px;}
.range-row input[type=range]{flex:1;-webkit-appearance:none;background:var(--s3);height:6px;border-radius:3px;outline:none;}
.range-row input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--sc);cursor:pointer;border:2px solid var(--bg);}
.range-val{font-family:'Space Mono',monospace;font-size:.82rem;color:var(--sc);min-width:56px;text-align:right;}
.slider-labels{display:flex;justify-content:space-between;font-size:.65rem;color:var(--t3);margin-top:2px;}

/* CTA */
.cta{width:100%;padding:13px;border:none;border-radius:10px;background:linear-gradient(135deg,var(--sc),var(--sc2));color:var(--bg);font-size:.92rem;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;transition:opacity .2s;letter-spacing:.3px;}
.cta:hover{opacity:.9;}

/* Quick scenario */
.scenarios{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:18px;}
.scen-btn{background:var(--s2);border:1px solid var(--bdr);border-radius:6px;padding:5px 10px;font-size:.72rem;color:var(--t2);cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .15s;}
.scen-btn:hover,.scen-btn.active{border-color:var(--sc);color:var(--sc);background:var(--sc-bg);}

/* Results area */
.results{min-height:400px;}

/* Result cards */
.res-strip{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
@media(max-width:960px){.res-strip{grid-template-columns:1fr 1fr;}}
.rcard{background:var(--s1);border:1px solid var(--bdr);border-radius:10px;padding:16px;}
.rcard .rl{font-size:.68rem;text-transform:uppercase;letter-spacing:.8px;color:var(--t2);margin-bottom:3px;}
.rcard .rv{font-family:'Space Mono',monospace;font-size:1.35rem;font-weight:700;}
.rcard .rn{font-size:.72rem;color:var(--t3);margin-top:2px;}
.rcard-score{border-color:var(--sc-bdr);background:linear-gradient(135deg,var(--sc-bg),transparent);}

/* Chart boxes */
.cbox{background:var(--s1);border:1px solid var(--bdr);border-radius:12px;padding:22px;margin-bottom:18px;}
.cbox h3{font-size:.88rem;font-weight:600;margin-bottom:14px;}
.cbox canvas{max-height:320px;}

/* Comparison table */
.ctable{width:100%;border-collapse:collapse;font-size:.8rem;}
.ctable th{text-align:left;padding:10px 12px;background:var(--s2);color:var(--sc);font-size:.68rem;text-transform:uppercase;letter-spacing:.5px;font-weight:600;}
.ctable td{padding:9px 12px;border-bottom:1px solid var(--bdr);}
.ctable tr:hover td{background:rgba(0,229,160,.02);}
.ctable .score-row td{background:var(--sc-bg);font-weight:600;}
.tag{display:inline-block;padding:2px 7px;border-radius:3px;font-size:.67rem;font-weight:600;}
.tg{background:var(--sc-bg);color:var(--sc);}
.tp{background:var(--gpu-bg);color:var(--gpu);}
.to{background:rgba(255,159,67,.12);color:var(--or);}
.tr{background:rgba(255,107,122,.12);color:var(--rd);}

/* Savings callout */
.savings-box{background:linear-gradient(135deg,var(--sc-bg),rgba(0,229,160,.04));border:1px solid var(--sc-bdr);border-radius:12px;padding:20px 24px;margin:18px 0;}
.savings-box .big{font-family:'Space Mono',monospace;font-size:2rem;font-weight:700;color:var(--sc);}
.savings-box p{font-size:.85rem;color:var(--t2);margin-top:4px;}

/* Hidden initially */
.hidden{display:none;}

/* Info tooltip */
.info{position:relative;display:inline-block;width:15px;height:15px;background:var(--s3);border-radius:50%;text-align:center;line-height:15px;font-size:.6rem;color:var(--t2);cursor:help;margin-left:4px;vertical-align:middle;}
.info:hover::after{content:attr(data-tip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:var(--s2);color:var(--t1);padding:6px 10px;border-radius:6px;font-size:.7rem;white-space:nowrap;z-index:10;border:1px solid var(--bdr);margin-bottom:4px;}
</style>
</head>
<body>
<div class="wrap">

<div class="hdr">
  <div class="pill">Interactive Calculator</div>
  <h1><em>Score Labs</em> Price Calculator</h1>
  <p>Build your inference scenario and instantly see how Score Labs CPU pricing compares to GPU providers using real market data.</p>
</div>

<div class="main-grid">
  <!-- LEFT PANEL: Inputs -->
  <div class="panel">
    <h2><span class="dot"></span> Build Your Scenario</h2>

    <div style="margin-bottom:14px;">
      <label style="font-size:.72rem;font-weight:600;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;display:block;">Quick Presets</label>
      <div class="scenarios">
        <button class="scen-btn" onclick="loadScenario('chatbot')">üí¨ Chatbot</button>
        <button class="scen-btn" onclick="loadScenario('rag')">üîç RAG Pipeline</button>
        <button class="scen-btn" onclick="loadScenario('batch')">üì¶ Batch Processing</button>
        <button class="scen-btn" onclick="loadScenario('startup')">üöÄ Startup MVP</button>
        <button class="scen-btn" onclick="loadScenario('enterprise')">üè¢ Enterprise</button>
      </div>
    </div>

    <div class="fg">
      <label>Model Size <span class="info" data-tip="Parameter count of the LLM you're running">?</span></label>
      <select id="modelSize">
        <option value="7">7B parameters (e.g. Mistral 7B, Llama 3.1 8B)</option>
        <option value="13">13B parameters (e.g. Llama 2 13B)</option>
        <option value="30" selected>30B parameters (e.g. Qwen 30B)</option>
        <option value="70">70B parameters (e.g. Llama 3.1 70B)</option>
        <option value="235">235B parameters (e.g. Qwen 235B)</option>
      </select>
    </div>

    <div class="fg">
      <label>Tokens per Request <span class="info" data-tip="Average input + output tokens per API call">?</span></label>
      <div class="range-row">
        <input type="range" id="tokensPerReq" min="100" max="8000" step="100" value="1500">
        <span class="range-val" id="tokensPerReqVal">1,500</span>
      </div>
      <div class="slider-labels"><span>100</span><span>4,000</span><span>8,000</span></div>
    </div>

    <div class="fg">
      <label>Requests per Minute <span class="info" data-tip="Total inference requests across all users per minute">?</span></label>
      <div class="range-row">
        <input type="range" id="reqPerMin" min="1" max="200" step="1" value="10">
        <span class="range-val" id="reqPerMinVal">10</span>
      </div>
      <div class="slider-labels"><span>1</span><span>100</span><span>200</span></div>
    </div>

    <div class="fg">
      <label>Concurrent Users <span class="info" data-tip="Peak simultaneous users hitting inference">?</span></label>
      <div class="range-row">
        <input type="range" id="concUsers" min="1" max="500" step="1" value="20">
        <span class="range-val" id="concUsersVal">20</span>
      </div>
      <div class="slider-labels"><span>1</span><span>250</span><span>500</span></div>
    </div>

    <div class="fg">
      <label>Hours per Day <span class="info" data-tip="How many hours/day is inference running">?</span></label>
      <div class="range-row">
        <input type="range" id="hoursDay" min="1" max="24" step="1" value="12">
        <span class="range-val" id="hoursDayVal">12</span>
      </div>
      <div class="slider-labels"><span>1hr</span><span>12hr</span><span>24hr</span></div>
    </div>

    <div class="fg">
      <label>Billing Period</label>
      <select id="period">
        <option value="hour">Per Hour</option>
        <option value="day">Per Day</option>
        <option value="month" selected>Per Month (30 days)</option>
        <option value="year">Per Year</option>
      </select>
    </div>

    <button class="cta" onclick="calculate()">‚ö° Calculate & Compare</button>
  </div>

  <!-- RIGHT: Results -->
  <div class="results" id="resultsArea">
    <!-- Initial state -->
    <div id="emptyState" style="text-align:center;padding:80px 20px;">
      <div style="font-size:3rem;margin-bottom:16px;">üìä</div>
      <h3 style="font-size:1.1rem;margin-bottom:8px;">Configure Your Scenario</h3>
      <p style="color:var(--t2);font-size:.88rem;max-width:400px;margin:0 auto;">Adjust the parameters on the left or pick a preset, then hit <strong style="color:var(--sc)">Calculate & Compare</strong> to see how Score Labs stacks up against GPU providers.</p>
    </div>

    <!-- Results (hidden until calculate) -->
    <div id="resultsContent" class="hidden">

      <!-- Scenario summary -->
      <div style="background:var(--s2);border-radius:10px;padding:14px 18px;margin-bottom:18px;font-size:.82rem;color:var(--t2);">
        <strong style="color:var(--t1);">Your Scenario:</strong> <span id="scenarioSummary"></span>
      </div>

      <!-- KPI strip -->
      <div class="res-strip">
        <div class="rcard rcard-score">
          <div class="rl">Score Labs Cost</div>
          <div class="rv" style="color:var(--sc)" id="kpiScore">‚Äî</div>
          <div class="rn" id="kpiScoreNote"></div>
        </div>
        <div class="rcard">
          <div class="rl">Cheapest GPU Option</div>
          <div class="rv" style="color:var(--gpu)" id="kpiCheapGPU">‚Äî</div>
          <div class="rn" id="kpiCheapGPUNote"></div>
        </div>
        <div class="rcard">
          <div class="rl">H100 Cost</div>
          <div class="rv" style="color:var(--or)" id="kpiH100">‚Äî</div>
          <div class="rn" id="kpiH100Note"></div>
        </div>
        <div class="rcard rcard-score">
          <div class="rl">Your Savings vs H100</div>
          <div class="rv" style="color:var(--sc)" id="kpiSavings">‚Äî</div>
          <div class="rn" id="kpiSavingsNote"></div>
        </div>
      </div>

      <!-- Bar chart: all providers -->
      <div class="cbox">
        <h3>üí∞ Cost Comparison: Score Labs vs All Providers</h3>
        <canvas id="mainChart"></canvas>
      </div>

      <!-- Two-col: bubble + table -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:18px;">
        <div class="cbox">
          <h3>‚ö° Cost vs Throughput (TPS)</h3>
          <canvas id="bubbleChart"></canvas>
        </div>
        <div class="cbox">
          <h3>üìä Servers / GPUs Required</h3>
          <canvas id="serverChart"></canvas>
        </div>
      </div>

      <!-- Full comparison table -->
      <div class="cbox" style="overflow-x:auto;">
        <h3>üìã Detailed Provider Comparison</h3>
        <table class="ctable" id="compTable">
          <thead>
            <tr>
              <th>Provider</th>
              <th>Type</th>
              <th>$/Hour</th>
              <th>Units Needed</th>
              <th>Period Cost</th>
              <th>$/1M Tokens</th>
              <th>TPS/Unit</th>
              <th>vs Score Labs</th>
            </tr>
          </thead>
          <tbody id="compBody"></tbody>
        </table>
      </div>

      <!-- Savings callout -->
      <div class="savings-box" id="savingsBox">
        <div class="big" id="savingsAmount">‚Äî</div>
        <p id="savingsDesc"></p>
      </div>

    </div>
  </div>
</div>

</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REAL MARKET DATA (from OpenRouter + pricing sheets)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PROVIDERS = {
  // GPU Cloud Providers ‚Äî hourly rates, TPS by model size, cost per 1M tokens (from OpenRouter data)
  'AIServe H100 80GB': {
    type:'GPU', hourly:3.99, color:'#8b6cff',
    tps:{7:120, 13:80, 30:45, 70:25, 235:12},
    cost1M:{30:0.10, 235:0.10} // market average from OpenRouter
  },
  'Hydra Host H200': {
    type:'GPU', hourly:2.85, color:'#7c5cfc',
    tps:{7:140, 13:95, 30:55, 70:30, 235:15},
    cost1M:{30:0.10, 235:0.10}
  },
  'Hydra Host B200': {
    type:'GPU', hourly:4.25, color:'#9b7eff',
    tps:{7:180, 13:120, 30:70, 70:40, 235:20},
    cost1M:{30:0.08, 235:0.07}
  },
  'AIServe A100 80GB': {
    type:'GPU', hourly:1.99, color:'#6c8cff',
    tps:{7:80, 13:50, 30:25, 70:12, 235:0},
    cost1M:{30:0.10, 235:0.20}
  },
  'AIServe A100 40GB': {
    type:'GPU', hourly:1.49, color:'#5c9cff',
    tps:{7:65, 13:40, 30:18, 70:0, 235:0},
    cost1M:{30:0.10, 235:null}
  },
  'Hydra Host L40S': {
    type:'GPU', hourly:1.08, color:'#4cacff',
    tps:{7:55, 13:35, 30:15, 70:0, 235:0},
    cost1M:{30:0.12, 235:null}
  },
  'AIServe RTX 4090': {
    type:'GPU', hourly:0.79, color:'#3cbcff',
    tps:{7:45, 13:25, 30:10, 70:0, 235:0},
    cost1M:{30:0.14, 235:null}
  },
  'Hydra Host RTX 4090': {
    type:'GPU', hourly:0.53, color:'#2cccff',
    tps:{7:45, 13:25, 30:10, 70:0, 235:0},
    cost1M:{30:0.14, 235:null}
  },
  'Hydra Host RTX 3090': {
    type:'GPU', hourly:0.30, color:'#1cdcff',
    tps:{7:30, 13:15, 30:5, 70:0, 235:0},
    cost1M:{30:0.20, 235:null}
  },
  // OpenRouter inference providers (token-based, from real benchmark data)
  'DeepInfra (API)': {
    type:'API', hourly:null, color:'#ff8c5c',
    tps:{7:60, 13:40, 30:25, 70:20, 235:20.7},
    cost1M:{7:0.03, 13:0.05, 30:0.09, 70:0.07, 235:0.071}
  },
  'WandB (API)': {
    type:'API', hourly:null, color:'#ffac4c',
    tps:{7:90, 13:65, 30:45, 70:42, 235:42.7},
    cost1M:{7:0.04, 13:0.06, 30:0.10, 70:0.10, 235:0.10}
  },
  'Cerebras (API)': {
    type:'API', hourly:null, color:'#ffcc3c',
    tps:{7:200, 13:150, 30:100, 70:60, 235:31.0},
    cost1M:{7:0.10, 13:0.20, 30:0.40, 70:0.50, 235:0.60}
  },
  'Nebius (API)': {
    type:'API', hourly:null, color:'#ff9c6c',
    tps:{7:40, 13:25, 30:8.5, 70:10, 235:13.8},
    cost1M:{7:0.04, 13:0.07, 30:0.10, 70:0.15, 235:0.20}
  },
};

// Score Labs CPU
const SCORE = {
  hourly: 1.39,
  // CPU TPS estimates (quantized models, AVX-512/AMX optimized)
  tps: {7:18, 13:10, 30:4, 70:1.5, 235:0},
  canRun: {7:true, 13:true, 30:true, 70:true, 235:false}
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRESETS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PRESETS = {
  chatbot:    {model:13, tokens:2000, rpm:15, users:30, hours:16},
  rag:        {model:7,  tokens:3000, rpm:8,  users:10, hours:12},
  batch:      {model:7,  tokens:1000, rpm:50, users:5,  hours:8},
  startup:    {model:13, tokens:1500, rpm:5,  users:10, hours:10},
  enterprise: {model:30, tokens:2000, rpm:80, users:100,hours:24},
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI BINDINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const $ = id => document.getElementById(id);
const sliders = ['tokensPerReq','reqPerMin','concUsers','hoursDay'];
sliders.forEach(id => {
  $(id).addEventListener('input', () => {
    $(id+'Val').textContent = Number($(id).value).toLocaleString();
  });
});

function loadScenario(key) {
  const s = PRESETS[key];
  $('modelSize').value = s.model;
  $('tokensPerReq').value = s.tokens; $('tokensPerReqVal').textContent = s.tokens.toLocaleString();
  $('reqPerMin').value = s.rpm; $('reqPerMinVal').textContent = s.rpm.toLocaleString();
  $('concUsers').value = s.users; $('concUsersVal').textContent = s.users.toLocaleString();
  $('hoursDay').value = s.hours; $('hoursDayVal').textContent = s.hours.toLocaleString();
  document.querySelectorAll('.scen-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  calculate();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CALCULATION ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let mainChartInst = null, bubbleChartInst = null, serverChartInst = null;

function calculate() {
  const modelSize = Number($('modelSize').value);
  const tokPerReq = Number($('tokensPerReq').value);
  const rpm       = Number($('reqPerMin').value);
  const concUsers = Number($('concUsers').value);
  const hrsPerDay = Number($('hoursDay').value);
  const period    = $('period').value;

  // Period multiplier (in hours)
  const periodHrs = period==='hour'?1 : period==='day'?hrsPerDay : period==='month'?hrsPerDay*30 : hrsPerDay*365;
  const periodLabel = period==='hour'?'/hr' : period==='day'?'/day' : period==='month'?'/mo' : '/yr';

  // Tokens per hour
  const tokensPerHour = rpm * 60 * tokPerReq;
  const totalTokens = tokensPerHour * periodHrs;

  // Score Labs calculation
  const scoreTPS = SCORE.tps[modelSize] || 0;
  const scoreCanRun = SCORE.canRun[modelSize] && scoreTPS > 0;

  // How many Score servers needed to handle the RPM?
  // Each server can handle: TPS * 60 / tokPerReq requests per minute
  let scoreServers = 1;
  if (scoreCanRun && scoreTPS > 0) {
    const scoreRPMCapacity = (scoreTPS * 60) / tokPerReq;
    scoreServers = Math.max(1, Math.ceil(rpm / scoreRPMCapacity));
  }
  const scoreCost = scoreCanRun ? SCORE.hourly * scoreServers * periodHrs : null;
  const scoreCostPer1M = scoreCanRun ? (SCORE.hourly * scoreServers) / (scoreTPS * scoreServers * 3600) * 1e6 : null;

  // Provider calculations
  let results = [];
  for (const [name, prov] of Object.entries(PROVIDERS)) {
    const tps = prov.tps[modelSize] || 0;
    if (tps === 0) continue; // can't run this model

    let cost, units, costPer1M;

    if (prov.type === 'API') {
      // Token-based pricing
      costPer1M = prov.cost1M[modelSize] || prov.cost1M[235] || 0.10;
      cost = (totalTokens / 1e6) * costPer1M;
      units = '‚Äî';
    } else {
      // GPU hourly pricing
      const gpuRPMCapacity = (tps * 60) / tokPerReq;
      const gpusNeeded = Math.max(1, Math.ceil(rpm / gpuRPMCapacity));
      cost = prov.hourly * gpusNeeded * periodHrs;
      units = gpusNeeded;
      costPer1M = (prov.hourly * gpusNeeded) / (tps * gpusNeeded * 3600) * 1e6;
    }

    const vScore = scoreCost ? ((cost - scoreCost) / scoreCost * 100) : null;

    results.push({
      name, type:prov.type, hourly:prov.hourly, tps, cost, units,
      costPer1M, color:prov.color, vScore
    });
  }

  results.sort((a,b) => a.cost - b.cost);

  // Find H100 and cheapest GPU
  const h100 = results.find(r => r.name.includes('H100'));
  const cheapGPU = results.filter(r=>r.type==='GPU').sort((a,b)=>a.cost-b.cost)[0];

  // ‚îÄ‚îÄ Update UI ‚îÄ‚îÄ
  $('emptyState').classList.add('hidden');
  $('resultsContent').classList.remove('hidden');

  // Scenario summary
  $('scenarioSummary').textContent = `${modelSize}B model ‚Ä¢ ${tokPerReq.toLocaleString()} tok/req ‚Ä¢ ${rpm} req/min ‚Ä¢ ${concUsers} concurrent users ‚Ä¢ ${hrsPerDay}hr/day`;

  // KPIs
  const fmt = v => v >= 10000 ? '$'+Math.round(v/1000).toLocaleString()+'K' : '$'+v.toLocaleString(undefined,{maximumFractionDigits:2});

  if (scoreCanRun) {
    $('kpiScore').textContent = fmt(scoreCost);
    $('kpiScoreNote').textContent = scoreServers + ' server' + (scoreServers>1?'s':'') + ' √ó $1.39/hr';
  } else {
    $('kpiScore').textContent = 'N/A';
    $('kpiScore').style.color = 'var(--rd)';
    $('kpiScoreNote').textContent = modelSize+'B too large for CPU';
  }

  if (cheapGPU) {
    $('kpiCheapGPU').textContent = fmt(cheapGPU.cost);
    $('kpiCheapGPUNote').textContent = cheapGPU.name;
  }
  if (h100) {
    $('kpiH100').textContent = fmt(h100.cost);
    $('kpiH100Note').textContent = h100.units + ' GPU(s) √ó $3.99/hr';
    if (scoreCost) {
      const sav = h100.cost - scoreCost;
      const pct = Math.round(sav/h100.cost*100);
      $('kpiSavings').textContent = fmt(sav);
      $('kpiSavingsNote').textContent = pct + '% less than H100';
    }
  }

  // Savings callout
  if (scoreCanRun && h100) {
    const annualSave = (h100.cost - scoreCost) * (period==='year'?1 : period==='month'?12 : period==='day'?365 : 8760);
    $('savingsAmount').textContent = fmt(annualSave) + '/year';
    $('savingsDesc').textContent = `By choosing Score Labs CPU over H100 GPU for this workload, you save approximately ${fmt(annualSave)} annually. That's ${Math.round((h100.cost-scoreCost)/h100.cost*100)}% lower total cost of ownership.`;
    $('savingsBox').style.display = 'block';
  } else if (!scoreCanRun) {
    $('savingsAmount').textContent = 'GPU Recommended';
    $('savingsDesc').textContent = `A ${modelSize}B parameter model exceeds practical CPU inference capabilities. Score Labs recommends GPU providers for this workload ‚Äî consider H200 or B200 for best performance.`;
    $('savingsBox').style.display = 'block';
  }

  // ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ
  // Destroy old
  if (mainChartInst) mainChartInst.destroy();
  if (bubbleChartInst) bubbleChartInst.destroy();
  if (serverChartInst) serverChartInst.destroy();

  // Prepare data with Score included
  let allResults = [...results];
  if (scoreCanRun) {
    allResults.push({name:'Score Labs CPU', type:'CPU', cost:scoreCost, tps:scoreTPS*scoreServers, units:scoreServers, costPer1M:scoreCostPer1M, color:'#00e5a0', vScore:0});
    allResults.sort((a,b)=>a.cost-b.cost);
  }

  // CHART 1: Main cost bar
  mainChartInst = new Chart($('mainChart').getContext('2d'), {
    type:'bar',
    data:{
      labels: allResults.map(r=>r.name),
      datasets:[{
        data: allResults.map(r=>r.cost),
        backgroundColor: allResults.map(r=> r.name.includes('Score') ? '#00e5a0' : r.color+'aa'),
        borderRadius: 4,
        borderWidth: allResults.map(r=> r.name.includes('Score') ? 2 : 0),
        borderColor: allResults.map(r=> r.name.includes('Score') ? '#00e5a0' : 'transparent'),
      }]
    },
    options:{
      responsive:true, indexAxis:'y',
      plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>'$'+c.parsed.x.toLocaleString(undefined,{maximumFractionDigits:2})+periodLabel}}},
      scales:{
        x:{ticks:{color:'#7b849c',callback:v=>'$'+v.toLocaleString()},grid:{color:'rgba(40,47,66,.4)'}},
        y:{ticks:{color:c=>{const l=allResults[c.index];return l&&l.name.includes('Score')?'#00e5a0':'#7b849c';},font:{size:10,weight:c=>allResults[c.index]&&allResults[c.index].name.includes('Score')?'bold':'normal'}},grid:{display:false}}
      }
    }
  });

  // CHART 2: Bubble ‚Äî cost vs TPS
  const bubbleData = allResults.filter(r=>r.tps>0).map(r=>({
    label:r.name,
    data:[{x:r.cost, y:r.tps, r: r.name.includes('Score')?14:9}],
    backgroundColor: r.name.includes('Score') ? '#00e5a0cc' : r.color+'88',
    borderColor: r.name.includes('Score') ? '#00e5a0' : 'transparent',
    borderWidth: r.name.includes('Score') ? 2 : 0,
  }));
  bubbleChartInst = new Chart($('bubbleChart').getContext('2d'), {
    type:'bubble',
    data:{datasets:bubbleData},
    options:{
      responsive:true,
      plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>c.dataset.label+': $'+c.parsed.x.toLocaleString(undefined,{maximumFractionDigits:2})+', '+c.parsed.y+' TPS'}}},
      scales:{
        x:{title:{display:true,text:'Total Cost'+periodLabel,color:'#7b849c'},ticks:{color:'#7b849c',callback:v=>'$'+v.toLocaleString()},grid:{color:'rgba(40,47,66,.4)'}},
        y:{title:{display:true,text:'Throughput (TPS)',color:'#7b849c'},ticks:{color:'#7b849c'},grid:{color:'rgba(40,47,66,.4)'}}
      }
    }
  });

  // CHART 3: Servers/GPUs needed
  const gpuProviders = allResults.filter(r=>r.units!=='‚Äî');
  serverChartInst = new Chart($('serverChart').getContext('2d'), {
    type:'bar',
    data:{
      labels:gpuProviders.map(r=>r.name),
      datasets:[{
        data:gpuProviders.map(r=>r.units),
        backgroundColor:gpuProviders.map(r=>r.name.includes('Score')?'#00e5a0':r.color+'88'),
        borderRadius:4
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>c.parsed.y+' unit(s)'}}},
      scales:{
        x:{ticks:{color:'#7b849c',font:{size:9},maxRotation:45},grid:{display:false}},
        y:{ticks:{color:'#7b849c',stepSize:1},grid:{color:'rgba(40,47,66,.4)'},title:{display:true,text:'Units Required',color:'#7b849c'}}
      }
    }
  });

  // ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ
  const tbody = $('compBody');
  tbody.innerHTML = '';

  // Score row first
  if (scoreCanRun) {
    const tr = document.createElement('tr');
    tr.className = 'score-row';
    tr.innerHTML = `
      <td style="color:var(--sc)">‚ö° Score Labs CPU</td>
      <td><span class="tag tg">CPU</span></td>
      <td>$1.39</td>
      <td>${scoreServers} server${scoreServers>1?'s':''}</td>
      <td style="color:var(--sc);font-family:'Space Mono',monospace;font-weight:700">${fmt(scoreCost)}</td>
      <td>${scoreCostPer1M?'$'+scoreCostPer1M.toFixed(3):'‚Äî'}</td>
      <td>${scoreTPS} TPS</td>
      <td><span class="tag tg">Baseline</span></td>
    `;
    tbody.appendChild(tr);
  }

  results.forEach(r => {
    const tr = document.createElement('tr');
    const diff = r.vScore;
    let diffTag = '';
    if (diff !== null) {
      if (diff > 50) diffTag = `<span class="tag tr">+${Math.round(diff)}% more</span>`;
      else if (diff > 10) diffTag = `<span class="tag to">+${Math.round(diff)}% more</span>`;
      else if (diff > -10) diffTag = `<span class="tag to">~Same</span>`;
      else diffTag = `<span class="tag tp">${Math.round(diff)}% less</span>`;
    } else {
      diffTag = '<span class="tag" style="color:var(--t3)">‚Äî</span>';
    }
    tr.innerHTML = `
      <td>${r.name}</td>
      <td><span class="tag ${r.type==='GPU'?'tp':'to'}">${r.type}</span></td>
      <td>${r.hourly?'$'+r.hourly.toFixed(2):'Token-based'}</td>
      <td>${r.units}</td>
      <td style="font-family:'Space Mono',monospace">${fmt(r.cost)}</td>
      <td>${r.costPer1M?'$'+r.costPer1M.toFixed(3):'‚Äî'}</td>
      <td>${r.tps} TPS</td>
      <td>${diffTag}</td>
    `;
    tbody.appendChild(tr);
  });
}

// Auto-calculate on load
calculate();
</script>
</body>
</html>
